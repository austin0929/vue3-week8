import{c as v}from"./cartStore-ljz3hO7I.js";import{_ as C,m as w,a as E,c as h,e as a,b as e,f as P,w as g,F as V,r as A,t as m,d as k,v as L,i as u,o as _,n as p}from"./index-CPAp1LdQ.js";var T={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"david777",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:f,VITE_APP_PATH:b}=T,U={data(){return{form:{user:{email:"",name:"",tel:"",address:""},message:""},couponCode:"",isLoading:!1}},computed:{...w(v,["carts","final_total","total"]),isFormEmpty(){return Object.values(this.form).some(o=>o==="")}},methods:{...E(v,["getCart"]),isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需要正確的電話號碼"},useCoupon(){const o=`${f}/api/${b}/coupon`,s={code:this.couponCode};this.$http.post(o,{data:s}).then(r=>{r.data.success&&(this.couponCode=r.data.code,console.log(r.data),this.$swal("成功","優惠券已加入","success"),this.getCart())}).catch(r=>{console.log(r),this.$swal("失敗","優惠券已使用","error")})},delAllCart(){const o=`${f}/api/${b}/carts`;this.$http.delete(o).then(s=>{s.data.success&&(this.$swal("刪除成功","購物車已清空","success"),this.getCart())}).catch(s=>{this.$swal("刪除失敗","購物車無資料","error")})},sendOrder(){this.isLoading=!0;const o=`${f}/api/${b}/order`;this.$http.post(o,{data:this.form}).then(s=>{if(s.data.success){const r=s.data.orderId;this.isLoading=!1,this.getCart(),this.$refs.form.resetForm(),this.$router.push(`/checkout/${r}`)}}).catch(s=>{this.$swal("建立訂單失敗","請檢查表單資訊","error")})}}},F={class:"container mt-7 noto-sans"},S={class:"row justify-content-center"},j={class:"col-md-8"},N=e("div",{class:"d-flex justify-content-around mb-4"},[e("span",{class:"border border-primary h4 px-lg-6 px-3 py-4"},"訂單資料"),e("span",{class:"border h4 px-lg-6 px-3 py-4 bg-primary text-light"},"付款確認"),e("span",{class:"border h4 px-lg-6 px-3 py-4 bg-primary text-light"},"完成訂單")],-1),I={class:"row mb-5"},O={class:"col-md-8"},R=e("h2",{class:"h4 mb-3"},"訂單資訊",-1),D={class:"mb-3"},M=e("label",{for:"email",class:"form-label"},"Email",-1),$={class:"mb-3"},B=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),q={class:"mb-3"},H=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),z={class:"mb-3"},G=e("label",{for:"address",class:"form-label"},"收件人地址",-1),J={class:"mb-3"},K=e("label",{for:"message",class:"form-label"},"留言",-1),Q={class:"text-end"},W=["disabled"],X={class:"col-md-4 mt-4 mt-md-0"},Y={class:"d-flex justify-content-between"},Z=e("h2",{class:"h4"},"購物車清單",-1),ee=e("hr",null,null,-1),se=e("hr",null,null,-1),te={class:"d-flex justify-content-between mb-1"},oe=e("span",null,"小計",-1),le={class:"d-flex justify-content-between mb-4"},ae=e("span",{class:"text-info fw-bold h5"},"總計",-1),ne={class:"text-info fw-bold h6"},re={class:"input-group mb-3"};function ie(o,s,r,de,l,i){const y=u("VueLoading"),d=u("VField"),c=u("ErrorMessage"),x=u("VForm");return _(),h(V,null,[a(y,{active:l.isLoading},null,8,["active"]),e("div",F,[e("div",S,[e("div",j,[N,e("div",I,[e("div",O,[R,a(x,{ref:"form",onSubmit:i.sendOrder},{default:P(({errors:t})=>[e("div",D,[M,a(d,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:l.form.user.email,"onUpdate:modelValue":s[0]||(s[0]=n=>l.form.user.email=n)},null,8,["class","modelValue"]),a(c,{name:"email",class:"invalid-feedback"})]),e("div",$,[B,a(d,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[1]||(s[1]=n=>l.form.user.name=n)},null,8,["class","modelValue"]),a(c,{name:"姓名",class:"invalid-feedback"})]),e("div",q,[H,a(d,{id:"tel",name:"tel",type:"text",class:p(["form-control",{"is-invalid":t.tel}]),placeholder:"請輸入電話",rules:i.isPhone,modelValue:l.form.user.tel,"onUpdate:modelValue":s[2]||(s[2]=n=>l.form.user.tel=n)},null,8,["rules","class","modelValue"]),a(c,{name:"tel",class:"invalid-feedback"})]),e("div",z,[G,a(d,{id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[3]||(s[3]=n=>l.form.user.address=n)},null,8,["class","modelValue"]),a(c,{name:"地址",class:"invalid-feedback"})]),e("div",J,[K,a(d,{id:"message",class:"form-control",name:"message",cols:"30",rows:"10",as:"textarea",modelValue:l.form.message,"onUpdate:modelValue":s[4]||(s[4]=n=>l.form.message=n)},null,8,["modelValue"])]),e("div",Q,[e("button",{type:"submit",class:"btn btn-primary btn-primary-hover border-0",disabled:i.isFormEmpty}," 送出訂單 ",8,W)])]),_:1},8,["onSubmit"])]),e("div",X,[e("div",Y,[Z,e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[5]||(s[5]=g((...t)=>i.delAllCart&&i.delAllCart(...t),["prevent"]))}," 清空購物車 ")]),ee,(_(!0),h(V,null,A(o.carts,t=>(_(),h("div",{class:"d-flex justify-content-between mb-1",key:t.id},[e("span",null,m(t.product.title),1),e("span",null,"NT$ "+m(t.product.price),1)]))),128)),se,e("div",te,[oe,e("span",null,"NT$ "+m(o.total),1)]),e("div",le,[ae,e("span",ne,"NT$ "+m(o.final_total),1)]),e("div",re,[k(e("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":s[6]||(s[6]=t=>l.couponCode=t)},null,512),[[L,l.couponCode]]),e("button",{class:"btn btn-primary btn-primary-hover border-0",type:"button",id:"button-addon2",onClick:s[7]||(s[7]=g((...t)=>i.useCoupon&&i.useCoupon(...t),["prevent"]))}," 送出 ")])])])])])])],64)}const ue=C(U,[["render",ie]]);export{ue as default};
